<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Fermah Quiz</title>
<style>
  :root{--bg:#0b1b22;--panel:#0e252e;--ink:#e8f6f2;--muted:#9fc6bb;--accent:#17c8a5;--good:#1fd38f;--bad:#ff6b6b}
  html,body{height:100%;margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif}
  .wrap{max-width:980px;margin:auto;padding:16px 14px 96px}
  header{display:flex;align-items:center;gap:12px;margin:8px 0 18px}
  .title{font-weight:800;font-size:28px}
  .tag{color:var(--muted);font-size:13px}
  .spacer{flex:1}
  .logo{width:44px;height:44px;border-radius:10px;background:#062027;display:grid;place-items:center;box-shadow:0 0 0 1px #07313a inset}
  .logo svg{width:28px;height:28px}
  .logout{margin-left:8px;display:none}
  .card{background:linear-gradient(180deg,#0e262f,#0e2127);border:1px solid #13333d;border-radius:14px;padding:16px 16px 14px;box-shadow:0 10px 24px rgba(0,0,0,.25)}
  .grid{display:grid;gap:12px}
  .two{grid-template-columns:1fr 1fr}
  .btn{background:var(--accent);border:none;color:#062027;font-weight:800;padding:12px 14px;border-radius:12px;cursor:pointer}
  .btn:active{transform:translateY(1px)}
  .btn.alt{background:#153943;color:#cdeee7;border:1px solid #24535f}
  .field{display:grid;gap:6px}
  input[type="text"],input[type="password"],select{
    background:#0a1d24;border:1px solid #173842;color:var(--ink);
    padding:11px 12px;border-radius:10px;outline:none
  }
  input[type="file"]{display:none}
  .fileRow{display:flex;align-items:center;gap:10px}
  .fileName{font-size:12px;color:var(--muted)}
  .center{display:grid;place-items:center;text-align:center}
  .pfp{width:84px;height:84px;border-radius:16px;object-fit:cover;border:1px solid #23444f;background:#0b1e25}
  .row{display:flex;gap:8px;align-items:center}
  .tiny{font-size:12px;color:var(--muted);cursor:pointer}
  .qtxt{font-size:20px;font-weight:700;margin:0 0 10px}
  .options{display:grid;gap:10px}
  .option{background:#0a1e25;border:1px solid #183a45;border-radius:12px;padding:12px;cursor:pointer;color:var(--ink)}
  .option:hover{border-color:#2a5d6b}
  .option.correct{border-color:var(--good);box-shadow:0 0 0 2px rgba(31,211,143,.15)}
  .option.wrong{border-color:var(--bad);box-shadow:0 0 0 2px rgba(255,107,107,.12)}
  .hud{display:flex;gap:10px;flex-wrap:wrap;margin:10px 0 14px}
  .chip{background:#0a1d23;border:1px solid #173741;color:#bfeee4;padding:6px 10px;border-radius:999px;font-size:13px}
  footer{position:fixed;left:0;right:0;bottom:0;padding:10px 14px;text-align:center;color:#96cfc3;background:linear-gradient(180deg,transparent,rgba(0,0,0,.35))}
  footer b{color:#d8fff7}
  #home .stats{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:10px}
  .tile{background:#0b1f26;border:1px solid #153c46;border-radius:12px;padding:12px;text-align:center}
  .tile b{display:block;font-size:18px}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div>
      <div class="title">Fermah Quiz</div>
      <div class="tag">Learn ZK + prove your knowledge.</div>
    </div>
    <div class="spacer"></div>
    <button class="btn alt logout" id="logoutBtn">Logout</button>
  </header>

  <!-- LOGIN -->
  <section id="login" class="card grid">
    <div class="grid two">
      <div class="field">
        <label class="muted">Create account</label>
        <input id="name" type="text" placeholder="Username" />
        <div class="fileRow">
          <input id="pfp" type="file" accept="image/png,image/jpeg" />
          <label for="pfp" class="btn alt">Choose Image</label>
          <span id="fileName" class="fileName">No image</span>
        </div>
        <div class="row">
          <input id="passCreate" type="password" placeholder="Password" style="flex:1">
          <span class="tiny" id="toggleCreate">Show</span>
        </div>
        <button class="btn" id="createBtn">Create & Continue</button>
      </div>
      <div class="field">
        <label class="muted">Or log in</label>
        <select id="loginSelect"></select>
        <div class="row">
          <input id="passLogin" type="password" placeholder="Password" style="flex:1">
          <span class="tiny" id="toggleLogin">Show</span>
        </div>
        <button class="btn alt" id="loginBtn">Login</button>
      </div>
    </div>
  </section>

  <!-- HOME -->
  <section id="home" class="card" style="display:none">
    <div class="grid two" style="align-items:center">
      <div class="row" style="gap:12px">
        <img id="homePfp" class="pfp" alt="">
        <div>
          <div style="font-weight:800" id="homeName"></div>
          <div class="muted" id="homeTag">Welcome back üëã</div>
        </div>
      </div>
      <div class="row" style="justify-content:flex-end">
        <button class="btn" id="startQuizBtn">Start Quiz</button>
      </div>
    </div>
    <div class="stats" style="margin-top:12px">
      <div class="tile"><span class="muted">Last Score</span><b id="statScore">‚Äì</b></div>
      <div class="tile"><span class="muted">Best IQ</span><b id="statIQ">‚Äì</b></div>
      <div class="tile"><span class="muted">Games</span><b id="statGames">‚Äì</b></div>
    </div>
  </section>

  <!-- QUIZ -->
  <section id="quiz" class="card" style="display:none">
    <div class="hud">
      <span class="chip" id="hudUser">üë§</span>
      <span class="chip">Q <b id="hudIdx">1</b>/<b id="hudTotal">20</b></span>
      <span class="chip">‚úÖ <b id="hudScore">0</b></span>
      <span class="chip">‚è±Ô∏è <b id="hudTime">0s</b></span>
    </div>
    <p class="qtxt" id="question"></p>
    <div class="options" id="options"></div>
    <div class="grid" style="margin-top:12px">
      <button class="btn alt" id="skipBtn">Skip</button>
    </div>
  </section>

  <!-- RESULT -->
  <section id="result" class="card" style="display:none">
    <div class="grid two" style="align-items:center">
      <div class="center">
        <img id="resPfp" class="pfp" alt="">
        <div style="font-weight:800;margin-top:8px" id="resName"></div>
        <div class="muted" id="resTag"></div>
      </div>
      <div>
        <div class="qtxt">Your Proof-IQ</div>
        <div id="resIQ" style="font-size:40px;font-weight:900;color:var(--accent)"></div>
        <div class="muted" id="resSummary"></div>
      </div>
    </div>
    <div class="grid" style="margin-top:12px">
      <img id="cardPreview" style="max-width:100%;border-radius:12px;border:1px solid #153c46;display:none"/>
      <div class="row" id="shareRow" style="display:none;justify-content:flex-end">
        <a id="dlCard" class="btn alt" download="fermah-quiz-card.png">Download</a>
        <button id="shareCard" class="btn">Share</button>
        <a id="shareX" class="btn" target="_blank">Share on X</a>
      </div>
    </div>
    <div class="grid" style="margin-top:12px">
      <button class="btn" id="playAgain">Back Home</button>
    </div>
  </section>
</div>

<footer>
  Made by <b>FreeGuyx247</b> ‚Ä¢ Community fan project (not official).
</footer>

<script>
/* local storage */
const LS_PROFILES='fermah_profiles_v3',LS_LAST='fermah_last_user';
const $=s=>document.querySelector(s),$$=s=>document.querySelectorAll(s);

let currentUser=null,quizSize=20,timerId=null,questions=[],idx=0,score=0,startTs=0;

function show(id){['login','home','quiz','result'].forEach(x=>$('#'+x).style.display=x===id?'block':'none')}
function refreshLoginSelect(){const sel=$('#loginSelect');sel.innerHTML='';loadProfiles().forEach((p,i)=>{const o=document.createElement('option');o.value=i;o.textContent=p.name;sel.appendChild(o)})}
function loadProfiles(){try{return JSON.parse(localStorage.getItem(LS_PROFILES)||'[]')}catch{return[]}}
function saveProfiles(a){localStorage.setItem(LS_PROFILES,JSON.stringify(a))}
async function sha256(s){const b=new TextEncoder().encode(s);const h=await crypto.subtle.digest('SHA-256',b);return[...new Uint8Array(h)].map(x=>x.toString(16).padStart(2,'0')).join('')}
const fileToDataURL=f=>new Promise((res,rej)=>{const r=new FileReader();r.onload=()=>res(r.result);r.onerror=rej;r.readAsDataURL(f)})

$('#toggleCreate').onclick=()=>{$('#passCreate').type=$('#passCreate').type==='password'?'text':'password'}
$('#toggleLogin').onclick=()=>{$('#passLogin').type=$('#passLogin').type==='password'?'text':'password'}
$('#pfp').addEventListener('change',e=>{$('#fileName').textContent=e.target.files[0]?e.target.files[0].name:'No image'})

$('#createBtn').onclick=async()=>{
  const name=$('#name').value.trim(); if(!name)return alert('Enter username')
  const pass=$('#passCreate').value; if(pass.length<6)return alert('Password too short')
  const hash=await sha256(pass); const f=$('#pfp').files[0]; const pfp=f?await fileToDataURL(f):''
  const list=loadProfiles(); if(list.some(p=>p.name.toLowerCase()===name.toLowerCase()))return alert('Exists')
  list.push({name,pfp,passHash:hash}); saveProfiles(list); localStorage.setItem(LS_LAST,name); refreshLoginSelect()
  alert('Account created, now login')
}

$('#loginBtn').onclick=async()=>{
  const list=loadProfiles();const user=list[$('#loginSelect').value|0];if(!user)return
  const input=$('#passLogin').value;const hash=await sha256(input);if(hash!==user.passHash)return alert('Wrong password')
  currentUser=user;localStorage.setItem(LS_LAST,user.name);$('#homeName').textContent=user.name;$('#homePfp').src=user.pfp||'';updateStats();$('#logoutBtn').style.display='inline-block';show('home')
}
$('#logoutBtn').onclick=()=>{currentUser=null;$('#logoutBtn').style.display='none';show('login')}

$('#startQuizBtn').onclick=()=>startQuiz()
$('#skipBtn').onclick=()=>{idx++;showQuestion()}
$('#playAgain').onclick=()=>{updateStats();show('home')}

/* quiz */
const BANK=[{q:"What is Fermah?",a:["Universal proof market","DEX","Bridge","Wallet"],i:0}, /* ... add more ... */];
function pickRandom(n,arr=BANK){return[...arr].sort(()=>Math.random()-0.5).slice(0,n)}
function startQuiz(){questions=pickRandom(quizSize).map(q=>{const opts=[...q.a].map((t,i)=>({t,i}));opts.sort(()=>Math.random()-0.5);return{q:q.q,opts,correct:opts.findIndex(o=>o.i===q.i)}});idx=0;score=0;startTs=Date.now();if(timerId)clearInterval(timerId);timerId=setInterval(()=>$('#hudTime').textContent=Math.floor((Date.now()-startTs)/1000)+'s',250);$('#hudUser').textContent=`üë§ ${currentUser.name}`;$('#hudScore').textContent=0;$('#hudTotal').textContent=quizSize;show('quiz');showQuestion()}
function showQuestion(){if(idx>=questions.length){endQuiz();return}const it=questions[idx];$('#hudIdx').textContent=idx+1;$('#question').textContent=it.q;const box=$('#options');box.innerHTML='';it.opts.forEach((o,i)=>{const b=document.createElement('button');b.className='option';b.textContent=o.t;b.onclick=()=>selectAnswer(i,b);box.appendChild(b)})}
function selectAnswer(i,btn){const it=questions[idx],all=[...$$('.option')];all.forEach(x=>x.disabled=true);if(i===it.correct){score++;btn.classList.add('correct')}else{btn.classList.add('wrong');all[it.correct].classList.add('correct')}$('#hudScore').textContent=score;setTimeout(()=>{idx++;showQuestion()},600)}
function endQuiz(){clearInterval(timerId);const total=questions.length,secs=Math.floor((Date.now()-startTs)/1000)||1,acc=score/total,iq=Math.round(60+40*acc+Math.min(20,200/secs));$('#resName').textContent=currentUser.name;$('#resPfp').src=currentUser.pfp||'';$('#resTag').textContent=`${score}/${total} correct ‚Ä¢ ${secs}s`;$('#resIQ').textContent=iq;$('#resSummary').textContent=`Accuracy ${(acc*100).toFixed(0)}%`;saveResult({score,total,secs,iq});buildCard({name:currentUser.name,pfp:currentUser.pfp,score,total,secs,iq});show('result')}

/* stats */
function saveResult(r){localStorage.setItem('fermah_last_result',JSON.stringify(r));const games=(+localStorage.getItem('fermah_games')||0)+1;localStorage.setItem('fermah_games',games);const best=Math.max(r.iq,(+localStorage.getItem('fermah_best')||0));localStorage.setItem('fermah_best',best)}
function updateStats(){const r=JSON.parse(localStorage.getItem('fermah_last_result')||'null');$('#statScore').textContent=r?`${r.score}/${r.total}`:'‚Äì';$('#statIQ').textContent=localStorage.getItem('fermah_best')||'‚Äì';$('#statGames').textContent=localStorage.getItem('fermah_games')||'‚Äì'}

/* card */
function buildCard({name,pfp,score,total,secs,iq}){const c=document.createElement('canvas');c.width=800;c.height=420;const g=c.getContext('2d');g.fillStyle='#0f2730';g.fillRect(0,0,800,420);g.fillStyle='#17c8a5';g.font='700 40px Arial';g.fillText('Fermah Proof-IQ',40,60);g.fillStyle='#e8f6f2';g.font='700 80px Arial';g.fillText(iq,40,160);g.font='20px Arial';g.fillText(`${score}/${total} correct in ${secs}s`,40,200);g.fillText(name,40,240);const data=c.toDataURL();$('#cardPreview').src=data;$('#cardPreview').style.display='block';$('#shareRow').style.display='flex';$('#dlCard').href=data;$('#shareX').href=`https://twitter.com/intent/tweet?text=My%20Fermah%20Proof-IQ%20is%20${iq}&url=${encodeURIComponent(location.href)}`}
</script>
</body>
</html>
